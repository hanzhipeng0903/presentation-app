# 换组分享 - 技术架构详细说明

## 演讲大纲

本次分享主要介绍工作方式与技术架构的差异，重点突出四个核心技术点：

## 1. 如何挂载到VO页面

### 挂载机制
- **脚本注入**：在VO页面中注入mai.js主入口文件，通过动态创建script标签实现
- **页面监听**：等待页面onload事件后延迟300ms初始化，避免与页面现有业务延迟代码冲突并发
- **资源加载**：动态加载CSS和JS资源，支持ES模块，生成独立JS文件
- **DOM挂载**：将MAI组件挂载到指定容器中，实现微前端架构

### 集成策略
- **样式隔离**：独立CSS作用域，避免样式污染，每个模块独立的样式文件
- **权限复用**：复用VO系统的登录、权限、日志等基础设施
- **通信机制**：通过事件总线与VO系统进行数据交换，解耦设计
- **生命周期**：独立的组件生命周期管理，不受VO系统影响

### 技术亮点
- 支持热更新调试，可通过Resource Override工具进行本地开发调试
- 支持局域网机器访问，通过环境变量配置HOST
- 微前端架构，独立开发部署，避免与现有业务冲突

## 2. 单页应用路由与缓存机制

### 路由跳转机制
- **URL匹配**：基于正则表达式的智能页面匹配路由，支持复杂规则配置
- **模块加载**：匹配成功后动态加载对应业务模块，按需加载提升性能
- **路由守卫**：自定义业务逻辑判断，支持权限控制，灵活的路由控制
- **无刷新切换**：客户端路由，页面切换流畅，用户体验优秀

### 页面缓存策略
- **组件缓存**：类似keep-alive机制，避免重复渲染，提升性能
- **状态保持**：页面切换时保持组件状态，减少数据重新获取
- **数据缓存**：避免重复API调用，智能缓存策略
- **DOM复用**：减少DOM重建，优化用户体验和性能

### 生命周期管理
- **问题描述**：mounted、unmounted等Vue生命周期钩子在微前端环境中不工作
- **解决方案**：使用Svelte原生生命周期钩子，如onMount、onDestroy、beforeUpdate等
- **注意事项**：避免在组件外部使用生命周期，确保正确的执行上下文

### 技术亮点
- 支持业务模块的独立开发、独立部署
- 通过事件总线实现模块间解耦通信
- 智能的缓存策略，提升应用性能

## 3. WebSocket信息推送架构

### 技术实现
- **底层库**：SockJS 1.6.1，兼容性更好，支持多种浏览器环境
- **协议层**：STOMP 2.3.3，消息格式标准化，便于与后端系统集成
- **连接管理**：自动重连机制，心跳检测，智能连接状态管理
- **错误处理**：网络异常时的降级方案，保证服务可用性

### 架构设计
- **观察者模式**：统一的事件管理机制，支持多个事件监听器
- **事件驱动**：基于事件的通信模型，解耦组件间依赖
- **消息分发**：自动分发到对应的处理器，智能路由
- **状态同步**：实时同步连接状态，多端数据一致性

### 应用场景
- **任务通知**：实时推送任务完成状态，提升用户体验
- **进度更新**：AI处理进度的实时反馈，用户了解处理状态
- **消息推送**：系统消息和业务通知，及时信息传达
- **状态同步**：多端数据状态同步，保证数据一致性

### 连接管理
- **自动重连**：连接断开时自动重连，指数退避算法
- **心跳检测**：定期发送ping消息，及时发现问题
- **状态监控**：实时监控连接状态，连接质量评估
- **降级方案**：网络异常时的处理策略，保证基本功能

### 技术亮点
- 支持STOMP协议，实现标准化的消息格式
- 便于与后端系统集成，支持多种消息类型
- 智能的连接管理，保证服务可用性

## 4. 数据管理与状态同步

### Svelte Stores状态管理
- **全局状态**：userInfoStore、serviceStore、homeStore等，统一状态管理
- **响应式更新**：状态变化自动触发UI更新，$: 语法声明
- **持久化存储**：支持localStorage数据持久化，跨会话状态保持
- **类型安全**：TypeScript类型定义，减少运行时错误

### 主子页面数据交互
- **数据存储**：每个业务模块独立的storage对象，数据隔离
- **数据获取**：通过entry和key获取对应数据，灵活的数据访问
- **数据设置**：支持复杂数据结构的存储，JSON序列化
- **数据同步**：主子页面间的数据状态同步，数据一致性

### 事件总线通信
- **事件注册**：支持多个事件监听器注册，灵活的事件绑定
- **事件触发**：通过事件名触发对应的处理器，解耦设计
- **数据传递**：支持复杂数据结构的传递，类型安全
- **解耦设计**：组件间通过事件进行通信，降低耦合度

### 技术亮点
- 支持多种状态管理方式，灵活选择
- 实现主子页面间的数据隔离和同步
- 事件驱动的架构，组件解耦

## 5. 构建方式与工程化

### 构建工具
- **Vite 4.5.1**：快速热重载，开发体验优秀，现代化构建工具
- **ES模块**：原生ES模块支持，开发效率高，Tree Shaking优化
- **Sass**：预处理器支持，样式开发便捷，变量和混入
- **TypeScript**：类型安全，代码质量保障，减少运行时错误

### 代码质量
- **ESLint**：代码规范检查，保持代码风格一致，团队协作
- **Husky**：Git钩子，提交前自动检查，代码质量门禁
- **TypeScript**：类型检查，减少运行时错误，开发体验
- **代码审查**：团队协作，提升代码质量，知识分享

### 部署发布
- **Release-it**：自动化版本管理和发布，版本号管理
- **环境配置**：开发、生产环境配置分离，环境变量管理
- **构建优化**：生产环境代码压缩和优化，性能提升
- **CDN部署**：静态资源CDN加速，全球访问优化

### 技术亮点
- 完整的工程化工具链，从开发到部署的全流程自动化
- 支持多种环境配置，灵活部署策略
- 自动化版本管理，减少人工错误

## 技术架构总结

### 核心优势
1. **微前端架构**：独立开发部署，避免业务冲突
2. **Svelte技术栈**：编译时框架，性能优异
3. **模块化设计**：业务模块独立，支持动态加载
4. **事件驱动**：基于事件总线的解耦通信
5. **实时通信**：WebSocket + STOMP协议
6. **工程化工具链**：从开发到部署的全流程自动化

### 应用场景
- SEO模块：产品润色、背景消除、视频生成
- 翻译模块：多语翻译、智能改写
- 询盘模块：翻译解析、生成回复、行为画像
- 开发信：客户管理、全网挖掘、行为画像

### 技术选型理由
- **Svelte**：编译时框架，运行时性能优异，包体积小
- **Vite**：快速热重载，开发体验优秀，ES模块支持
- **WebSocket**：实时通信需求，低延迟，双向通信
- **微前端**：业务模块独立，团队协作，技术栈灵活

## 演讲要点提示

1. **开场**：介绍项目背景和业务价值
2. **技术架构**：重点突出四个核心技术点
3. **实际案例**：结合具体业务场景说明技术应用
4. **技术亮点**：强调技术选型的优势和效果
5. **总结**：技术架构的价值和未来发展方向

## 常见问题准备

1. **为什么选择Svelte而不是React/Vue？**
2. **微前端架构的挑战和解决方案？**
3. **WebSocket连接断开如何处理？**
4. **如何保证主子页面数据一致性？**
5. **性能优化的具体措施？**

---

*本README文件包含详细的技术说明，供演讲者参考使用。*
